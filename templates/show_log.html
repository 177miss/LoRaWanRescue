

<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>应急救援服务平台</title>

<script type="text/javascript" src="/static/js/echarts.min.js"></script>
<script type="text/javascript" src="/static/js/china.js"></script>
<link rel="stylesheet" href="/static/css/style.css">
<link rel="stylesheet" href="/static/css/show_admin.css">
<link rel="stylesheet" href="/static/plugins/bootstrap-5.3.0-dist/css/bootstrap.min.css">
<link rel="stylesheet" href="/static/css/index.css">
<link rel="stylesheet" href="/static/css/show_admin.css">
<link rel="shortcut icon" href="/static/images/zy.png" />
<script src="/static/plugins/bootstrap-5.3.0-dist/js/bootstrap.bundle.min.js"></script>
<script src="/static/plugins/jquery-3.6.0.min.js"></script>
<script src="/static/plugins/jquery.table2excel.js"></script>
<script src="/static/js/show_admin.js"></script>
</head>
<body>
	<div class="head clearfix">
		<h1 class="pulll_left">应急救援服务平台</h1>
		<div class="menu menu2 pulll_left">
			<ul>      
				<li><a href="/show_situation_map">概览页面</a></li>
				<li><a href="/show_message">报警监控</a></li>
                <li><a href="/show_map">救援地图</a></li>
				<li><a href="/show_users">连接管理</a></li>
				<li><a href="/show_management">系统管理</a></li>
				<li><a href="/show_log">系统日志</a></li>
			</ul>
		</div>
		<div class="time" id="showTime">2018/6/12 17:00:12</div>
	</div>
	
	<div class="mainbox">
		<ul class="clearfix nav1"> 
			<li style="width: 70%;">
				<div class="box">
                    <div id="tm" class="tit">系统日志</div>
					<div class="boxnav mapc" style="height: 784px; position: relative">
						<div id="right-content">
                
                            <div name="form-message" style="padding-left: 10%;" id="excel-out">
                                <div id="right-thead">
                                    <table class="table table-hover">
                                        <thead>
                                            <p>
												<td id = "tm" style = "width: 20px;"></td>
                                                <td id = "tm" style = "width: 80px;">时间</td>
                                                <td id="tm" style = "width: 100px;">类型</td>
                                                <td id="tm" style = "width: 150px;">内容</td>
                                            </p>
                                        </thead>
                                    </table>
                                </div>
                        <div id="right-tbody" >
							<table class="table table-hover">
								{% for log in table_log reversed %}
									<tr class="log-row" data-type="{{ log.type }}">
										<td id="tm" style="padding-top: 16px; width: 200px;">{{ log.time }}</td>
										<td id="tm" style="padding-top: 16px; width: 100px;">{{ log.type }}</td>
										<td id="tm" style="padding-top: 16px; width: 400px;">{{ log.text }}</td>
										<td id = "tm"><button type="submit" class="btn btn-primary">查看详情</button></td>
									</tr>
									{% endfor %}
							</table>
							<script>
								function set_type(type = 0)
								{
									var logRows = document.getElementsByClassName("log-row");
									for (var j = 0; j < logRows.length; j++) {
										if (type == 0)
										{
											logRows[j].style.display = "";
										}
										else if (type == 1)
										{
											if (logRows[j].getAttribute("data-type") == "INFO") {
										logRows[j].style.display = ""; // 显示行
										} else {
										logRows[j].style.display = "none"; // 隐藏行
										}
										}
										else if (type == 2)
										{
											if (logRows[j].getAttribute("data-type") == "WARNING" ) {
										logRows[j].style.display = ""; // 显示行
										} else {
										logRows[j].style.display = "none"; // 隐藏行
										}
										}
										else if (type == 3)
										{
											if (logRows[j].getAttribute("data-type") == "ERROR" ) {
										logRows[j].style.display = ""; // 显示行
										} else {
										logRows[j].style.display = "none"; // 隐藏行
										}
										}
									}
								};
								set_type(0);
							</script>
					</div>
				</div>
						</div>
			</li>
			<li style="width: 30%">
				<div class="box">
					<div id="tm" class="tit">类型筛选</div>
					<div class="boxnav" id="echart4" style="height: 410px">
						<td id="tm">
							<button type="submit" class="btn btn-primary" onclick="set_type(0)">所有类型</button>
						</td>
						<p></p>
						<td id="tm">
							<button type="submit" class="btn btn-primary" onclick="set_type(1)">INFO类型</button>
						</td>
						<p></p>
						<td id="tm">
								<button type="submit" class="btn btn-primary" onclick="set_type(2)">WARNING类型</button>
						</td>
						<p></p>
						<td id="tm">
								<button type="submit" class="btn btn-primary" onclick="set_type(3)">ERROR类型</button>
						</td>
					</div>
				</div>
				<div class="box">
					<div id="tm" class="tit">数据分析</div>

					<div class="boxnav" style="height: 315px;" id="echart5" >
					</div>
					<script>
						var info = 0;
						var warning = 0;
						var error = 0;
						var logRows = document.getElementsByClassName("log-row");
									for (var j = 0; j < logRows.length; j++) {
										if (logRows[j].getAttribute("data-type") == "INFO")info+=1;
										if (logRows[j].getAttribute("data-type") == "WARNING")warning+=1;
										if (logRows[j].getAttribute("data-type") == "ERROR")error+=1;
									}
						function echarts_5() {
        // 基于准备好的dom，初始化echarts实例
        var myChart = echarts.init(document.getElementById('echart5'));
 option = {
          legend: {
           orient: 'vertical',
            itemWidth: 10,
            itemHeight: 10,
            textStyle:{
                color:'rgba(255,255,255,.5)'
            },
              top:'20%',
          right:30,
            data:['INFO','WARNING','ERROR']
        },
        color: ['#37a2da','#32c5e9','#9fe6b8','#ffdb5c','#ff9f7f','#fb7293','#e7bcf3','#8378ea'],
        tooltip : {
            trigger: 'item',
            formatter: "{b} : {c} ({d}%)"
        },
       
        calculable : true,
        series : [
            {
              
                type:'pie',
                radius : [0, 50],
                center: ["35%", "50%"],
              
                data:[ 
                    {value:info, name:'INFO'},
                    {value:warning, name:'WARNING'},
                    {value:error, name:'ERROR'},
                ],
                 label: {
                 normal: {
                     formatter: function(param) {
                         return param.name +':\n' + param.value +'\n';
                     }
    
                 }
             },
             labelLine: {
                 normal: {
                      length:5,
                      length2:15,
                     lineStyle: { width: 1}
                 }
             },
    
             itemStyle: {
                 normal: {
                     shadowBlur: 30,
                     shadowColor: 'rgba(0, 0, 0, 0.4)'
                 }
    
             },
            }
        ]
    };
        myChart.setOption(option);
        window.addEventListener("resize",function(){
            myChart.resize();
        });
    }echarts_5();
					</script>
				</div>
			</li>
		</ul>
		
		
		
		<script>
			var t = null;
			t = setTimeout(time,1000);//開始运行
			function time()
			{
				clearTimeout(t);//清除定时器
				dt = new Date();
				var y=dt.getFullYear();
				var mt=dt.getMonth()+1;
				var day=dt.getDate();
				var h=dt.getHours();//获取时
				var m=dt.getMinutes();//获取分
				var s=dt.getSeconds();//获取秒
				document.getElementById("showTime").innerHTML = y+"/"+mt+"/"+day+" "+h+":"+m+":"+s+"";
				t = setTimeout(time,1000); //设定定时器，循环运行     
			} 
		</script>
	</div>
</body>
</html>
